<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Clojure Test</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/stylesheets/main.css"/>

    <link href="select2/css/select2.min.css" rel="stylesheet" />

    <script src="jquery-2.1.3.min.js"></script>
    <script src="select2/js/select2.min.js"></script>

    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="react/react.js"></script>
    <script src="react/JSXTransformer.js"></script>
</head>

<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div>
            <ul class="nav navbar-nav  navbar-fixed-top">
                <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
                <li><a href="#">Link</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                        <li class="divider"></li>
                        <li><a href="#">One more separated link</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default">Submit</button>
                </div>
            </form>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<script type="text/javascript">
  $('select').select2();
</script>

<script  type="text/jsx">
var FuncParams =  React.createClass({
  handleChange: function() {
    this.props.onUserInput(
      this.refs.funcNameSelect.getDOMNode().value,
      this.refs.param0Input.getDOMNode().value,
      this.refs.param1Input.getDOMNode().value,
      this.refs.param2Input.getDOMNode().value
    );
  },
  render: function() {
    return (
    <form>
<div className="input-group">
  <span className="input-group-addon" id="basic-addon1">@</span>
  <input ref="param0Input" value={this.props.param0} onChange={this.handleChange}  type="text" className="form-control" placeholder="Username" aria-describedby="basic-addon1">
  </input>
</div>

<div className="input-group">
  <input ref="param1Input" value={this.props.param1} onChange={this.handleChange} type="text" className="form-control" placeholder="Recipient's username" aria-describedby="basic-addon2">
  </input>
  <span className="input-group-addon" id="basic-addon2">@example.com</span>
</div>

<div className="input-group">
  <span className="input-group-addon">$</span>
  <input ref="param2Input" value={this.props.param2}  onChange={this.handleChange} type="text" className="form-control" aria-label="Amount (to the nearest dollar)">
  </input>
  <span className="input-group-addon">.00</span>
</div>

      <select ref="funcNameSelect" value={this.props.funcName}
         onChange={this.handleChange}  className="js-example-basic-single"
      >
        <option value="formatStr">formatStr</option>
        <option value="formatStr2">formatStr2</option>
      </select>

</form>

    );
  }
});

var TestClojure = React.createClass({
    getInitialState: function() {
        return {
            funcName: 'formatStr',
            param0: '',
            param1: '',
            param2: '',
            retval: ''
        };
    },


    handleUserInput: function(funcName, param0, param1, param2) {
        component = this;
        component.setState({
            funcName: funcName,
            param0: param0,
            param1: param1,
            param2: param2,
            retval: "Calculating..."
        });

        $.ajax(
            {
                url: "clojure?action=" + funcName + "&param0=" + encodeURIComponent(param0) + "&param1=" + encodeURIComponent(param1) + "&param2=" + encodeURIComponent(param2),
                success:
                    function(result){
                        component.setState({
                            funcName: funcName,
                            param0: param0,
                            param1: param1,
                            param2: param2,
                            retval: result
                        });
                   }
            });
    },

  render: function() {
    return (
      <div>
        <FuncParams
         param0={this.state.param0}
         param1={this.state.param1}
         param2={this.state.param2}
         funcName={this.state.funcName}
         onUserInput={this.handleUserInput}
        />
        <div>
          <span>{this.state.retval}</span>
        </div>
      </div>
    );
  }
});

React.render(
  <TestClojure />,
  document.getElementById("testClojure")
);


</script>

    <div id="testClojure" />
</body>
</html>
